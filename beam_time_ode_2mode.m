function [udot,xr,u_cont]=beam_time_ode_2mode(t,u,M,L,D,S,E,G,J,P,K,B,yr)
udot=zeros(4,1);
u1=u(1);
u2=u(2);
u1d=u(3);
u2d=u(4);


c2=1000000;
c1=1000000;
T=0.02;
Am=1e-6;
xr=Am*sin(2*pi/T*t);
d_xr=Am*2*pi/T*cos(2*pi/T*t);
dd_xr=-Am*(2*pi/T)^2*sin(2*pi/T*t);



%% Reference Signal
% K1=600;
% K2=90000;
% a=1e-6;
% b=.5e-6;
% t1=0.03;
% u=(a*heaviside(t)-b*heaviside(t-t1));
% xr=yr(1);
% d_xr=yr(2);
% dd_xr=K2*u-K1*d_xr-K2*xr;


%% Controller


z1=u1-xr;
alpha=d_xr-c1*z1;
z2=u1d-alpha;
% u_cont=(-c2*z2+dd_xr-z1-K/M*z1-c1*(u1d-d_xr))/(-1/M*(L+D*u1^2+E*u1^3+...
%     G*u1^4+J*u1^5));
u_cont=(-c2*z2+dd_xr-z1-K/M*z1-c1*(u1d-d_xr)-z1)/(-1/M*(L+D*u1^2+E*u1^3+...
    G*u1^4));

% if (u_cont)>30 
%     u_cont=30;
% elseif (u_cont)<30
%     u_cont=-30;
% end
%% Plant
udot(1)=u1d;
udot(2)=u2d;
udot(3)=(- 3085772327831209026519040.0*u1^4 + 6566000000000000000000000.0*u1^3*u2 + 8922000000000000000.0*u1^3 - 9826699928654852206362624.0*u1^2*u2^2 - 11451169749807923200.0*u1^2*u2 - 25245755842560.0*u1^2 + 3577000000000000000000000.0*u1*u2^3 + 14660000000000000000.0*u1*u2^2 + 13660000000000.0*u1*u2 + 68330000.0*u1 - 1548075476696426348544000.0*u2^4 - 998469096834072576.0*u2^3 - 16311890018048.0*u2^2 - 14022.0549924373626708984375*u2 - 160.0)*u_cont - 52746083737.268155594944221726515*u1;
udot(4)=(1644000000000000000000000.0*u1^4 - 6551133288725388726370304.0*u1^3*u2 - 3817056584924659712.0*u1^3 + 5355000000000000000000000.0*u1^2*u2^2 + 14660000000000000000.0*u1^2*u2 + 6822000000000.0*u1^2 - 6192301909600455161282560.0*u1*u2^3 - 2995407291844395008.0*u1*u2^2 - 32623780050432.0*u1*u2 - 14022.0549986362457275390625*u1 - 253768092588211215269888.0*u2^4 + 6777000000000000000.0*u2^3 - 7741984130816.0*u2^2 + 68330000.0*u2 - 88.899999999906867742538452148438)*u_cont - 2071546959035.9702038009643890601*u2;


% V=1*sin(100000*t);

% switch m
%     case 4
%         udot=[u1d;-1/M*(M*lambda*u1+L*u_cont+D*u_cont*u1^2+(S+E*u_cont)*u1^3+...
%     G*u_cont*u1^4+J*u_cont*u1^5)];
% end
if rem(t,0.001)<0.0001
    t
    u_cont;
end